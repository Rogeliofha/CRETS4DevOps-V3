<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRETS4DevOps V2 - System Architecture</title>
    <script src="https://unpkg.com/mermaid@9.4.3/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0078d4;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #323130;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 10px;
        }
        h3 {
            color: #605e5c;
            margin-top: 25px;
        }
        .version-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .diagram-container {
            margin: 30px 0;
            text-align: center;
            background: #fafafa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e1e1;
        }
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .tech-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .tech-card h3 {
            margin-top: 0;
            font-size: 1.2em;
        }
        .features {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .features ul {
            list-style-type: none;
            padding: 0;
        }
        .features li {
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #0078d4;
        }
        .features li:before {
            content: "‚úì ";
            color: #107c10;
            font-weight: bold;
        }
        .new-features {
            background: #fff4e6;
            border-left: 4px solid #ff8c00;
        }
        .new-features li:before {
            content: "üÜï ";
            color: #ff8c00;
        }
        .architecture-evolution {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4169e1;
        }
        .version-timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }
        .version-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0078d4;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .version-number {
            font-weight: bold;
            color: #0078d4;
            font-size: 1.1em;
        }
        .diagram-container .mermaid {
            font-family: 'Segoe UI', sans-serif;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå± CRETS4DevOps V2 - Advanced System Architecture <span class="version-badge">v2.5.2</span></h1>
        
        <div class="architecture-evolution">
            <h3>üìà Architecture Evolution Summary</h3>
            <p><strong>CRETS4DevOps V2</strong> represents a significant evolution from basic sustainability requirements management to a sophisticated, independent, and user-friendly system with complete Work Item isolation, multi-language support, and professional UI/UX design.</p>
        </div>

        <h2>üèóÔ∏è Enhanced Architecture Overview</h2>
        <div class="diagram-container">
            <div class="mermaid">
                graph TB
                    User["DevOps Team<br/>üë§ End Users"] --> AzureDevOps["Azure DevOps Platform<br/>üåê Enterprise DevOps"]
                    
                    AzureDevOps --> WorkItems["Work Items<br/>üìã PBI, Epic, Feature, Bug, Task"]
                    AzureDevOps --> Extension["CRETS4DevOps V2<br/>üì± Browser Extension"]
                    
                    Extension --> HubView["Hub View<br/>üè† Main Requirements Manager"]
                    Extension --> WorkItemView["Work Item View<br/>üìÑ Independent Requirements Tab"]
                    
                    HubView --> ReactApp["React Application<br/>‚öõÔ∏è TypeScript + Hooks"]
                    WorkItemView --> ReactApp
                    
                    ReactApp --> Independence["Independence Engine<br/>üîí Per-WorkItem Storage"]
                    ReactApp --> EditingSystem["Editing System<br/>‚úèÔ∏è In-place Modifications"]
                    ReactApp --> AutoRefresh["Auto-refresh System<br/>üîÑ Real-time Updates"]
                    
                    Independence --> WorkItemStorage["WorkItemStorage Class<br/>üíæ Isolated Data Management"]
                    EditingSystem --> RequirementItem["RequirementItem Component<br/>üß© Edit/Save/Restore"]
                    AutoRefresh --> EventSystem["Event System<br/>üì° Cross-frame Communication"]
                    
                    WorkItemStorage --> LocalStorage["localStorage<br/>üóÑÔ∏è Browser Persistence"]
                    WorkItemStorage --> JSONCatalog["JSON Catalog<br/>üìö Requirements Database"]
                    
                    EventSystem --> PostMessage["postMessage API<br/>üì§ Cross-origin Communication"]
                    EventSystem --> CustomEvents["CustomEvent API<br/>‚ö° DOM Events"]
                    EventSystem --> LocalStorageEvents["Storage Events<br/>üì° Storage Listeners"]
                    
                    style User fill:#e1f5fe
                    style AzureDevOps fill:#f3e5f5
                    style Extension fill:#e8f5e8
                    style Independence fill:#fff3e0
                    style EditingSystem fill:#fce4ec
                    style AutoRefresh fill:#f1f8e9
            </div>
        </div>

        <h2>üîÑ Advanced Data Flow and Independence Model</h2>
        <div class="diagram-container">
            <div class="mermaid">
                sequenceDiagram
                    participant U as User
                    participant Hub as Hub View
                    participant WI1 as Work Item A
                    participant WI2 as Work Item B
                    participant WIS as WorkItemStorage
                    participant LS as localStorage
                    
                    Note over U,LS: Phase 1: Requirements Selection
                    U->>Hub: Select requirements
                    Hub->>LS: Store pending requirements
                    
                    Note over U,LS: Phase 2: Independent Application
                    U->>WI1: Open Work Item A
                    WI1->>WIS: Initialize with ID_A
                    WIS->>LS: Read from key "selectedRequirements_ID_A"
                    LS->>WIS: Return Work Item A data
                    WIS->>WI1: Display A's requirements
                    
                    Note over U,LS: Phase 3: Parallel Independence
                    U->>WI2: Open Work Item B (different tab)
                    WI2->>WIS: Initialize with ID_B
                    WIS->>LS: Read from key "selectedRequirements_ID_B"
                    LS->>WIS: Return Work Item B data
                    WIS->>WI2: Display B's requirements
                    
                    Note over U,LS: Phase 4: Independent Editing
                    U->>WI1: Edit requirement in A
                    WI1->>WIS: Save changes to ID_A
                    WIS->>LS: Update key "selectedRequirements_ID_A"
                    Note over WI2: Work Item B remains unaffected
                    
                    Note over U,LS: Phase 5: Auto-refresh Synchronization
                    WI1->>WI1: Dispatch custom event
                    WI1->>WI2: Cross-frame notification
                    WI2->>WIS: Refresh own data (ID_B)
                    WIS->>WI2: Confirm independence maintained
            </div>
        </div>

        <h2>üè¢ Enhanced Technology Stack</h2>
        <div class="tech-stack">
            <div class="tech-card">
                <h3>‚öõÔ∏è Frontend Layer</h3>
                <p>React 17 + TypeScript</p>
                <small>Modern UI with strong typing, hooks, and functional components</small>
            </div>
            <div class="tech-card">
                <h3>üîß Integration Layer</h3>
                <p>Azure DevOps SDK v3.1.0</p>
                <small>IWorkItemFormService integration with universal Work Item support</small>
            </div>
            <div class="tech-card">
                <h3>üíæ Data Layer</h3>
                <p>WorkItemStorage + localStorage</p>
                <small>Independent per-Work Item storage with real Azure DevOps IDs</small>
            </div>
            <div class="tech-card">
                <h3>üé® UI/UX Layer</h3>
                <p>Professional CSS + Webpack</p>
                <small>Clean English interface, no emojis, optimized bundle (247KB)</small>
            </div>
            <div class="tech-card">
                <h3>üì° Communication Layer</h3>
                <p>Multi-channel Events</p>
                <small>postMessage + CustomEvent + Storage events for real-time sync</small>
            </div>
            <div class="tech-card">
                <h3>üîí Independence Engine</h3>
                <p>Per-WorkItem Isolation</p>
                <small>Complete independence with ID-based storage keys</small>
            </div>
        </div>

        <h2>üÜï Version 2.5.x New Features</h2>
        <div class="features new-features">
            <ul>
                <li>Complete English translation of all user-facing text and dialogs</li>
                <li>Clean professional UI without emojis in buttons</li>
                <li>Blue-colored refresh button for better visual hierarchy</li>
                <li>Removed technical Work Item information display</li>
                <li>Eliminated non-functional "Test Independence" button</li>
                <li>Professional confirmation dialogs without browser headers</li>
                <li>Optimized bundle size to 247KB</li>
                <li>Enhanced user experience for international usage</li>
            </ul>
        </div>

        <h2>üèóÔ∏è Core Features (All Versions)</h2>
        <div class="features">
            <ul>
                <li>Complete Work Item independence - each Work Item has isolated requirements</li>
                <li>In-place editing with save/cancel/restore functionality</li>
                <li>Auto-refresh system for real-time synchronization between views</li>
                <li>Universal Work Item type support (PBI, Epic, Feature, Bug, Task, etc.)</li>
                <li>Hierarchical requirements management with parent-child relationships</li>
                <li>Real Azure DevOps Work Item ID integration (not fake IDs)</li>
                <li>Multi-channel communication system for cross-frame updates</li>
                <li>Professional English interface for international use</li>
                <li>Comprehensive CRUD operations on sustainability requirements</li>
                <li>Advanced search and filtering capabilities</li>
                <li>Validation of hierarchical requirement codes</li>
                <li>Direct application to Azure DevOps Work Items</li>
            </ul>
        </div>

        <h2>üìã Version Timeline</h2>
        <div class="version-timeline">
            <div class="version-item">
                <div class="version-number">v2.5.2 - UI Cleanup Release</div>
                <p><strong>December 2024:</strong> Removed technical Work Item information display for cleaner user experience. Bundle optimized to 247KB.</p>
            </div>
            <div class="version-item">
                <div class="version-number">v2.5.1 - Complete Dialog Translation</div>
                <p><strong>December 2024:</strong> Translated Work Item-specific confirmation dialogs and success messages to English.</p>
            </div>
            <div class="version-item">
                <div class="version-number">v2.5.0 - Hub Dialog Translation</div>
                <p><strong>December 2024:</strong> Translated main hub confirmation dialogs to English for professional appearance.</p>
            </div>
            <div class="version-item">
                <div class="version-number">v2.4.0 - International UI Release</div>
                <p><strong>December 2024:</strong> Complete English translation of interface, removed emojis from buttons, blue refresh button, eliminated Test Independence button.</p>
            </div>
            <div class="version-item">
                <div class="version-number">v2.3.0 - Independent Editing Release</div>
                <p><strong>November 2024:</strong> Implemented complete in-place editing functionality with save/cancel/restore operations while maintaining total Work Item independence.</p>
            </div>
            <div class="version-item">
                <div class="version-number">v2.2.0 - Auto-refresh Release</div>
                <p><strong>November 2024:</strong> Implemented automatic refresh system using multi-channel communication for real-time synchronization between hub and Work Item views.</p>
            </div>
            <div class="version-item">
                <div class="version-number">v2.1.x - Independence Implementation</div>
                <p><strong>October 2024:</strong> Achieved complete Work Item independence using real Azure DevOps IDs and isolated storage keys. Fixed critical sharing issues.</p>
            </div>
            <div class="version-item">
                <div class="version-number">v2.0.0 - Foundation Release</div>
                <p><strong>September 2024:</strong> Initial release with basic sustainability requirements management and Azure DevOps integration.</p>
            </div>
        </div>

        <h2>üß© Advanced Component Architecture</h2>
        <div class="diagram-container">
            <div class="mermaid">
                graph TB
                    Main["SustainabilityRequirements<br/>üè† Main Hub Component"] --> WorkItemReq["WorkItemRequirements<br/>üìÑ Work Item Tab Component"]
                    
                    Main --> ReqItem1["RequirementItem<br/>üß© Recursive Component"]
                    WorkItemReq --> ReqItem2["RequirementItem<br/>üß© With Editing Capability"]
                    
                    ReqItem2 --> EditForm["Inline Edit Form<br/>‚úèÔ∏è Detail/Justification/Discussion"]
                    ReqItem2 --> ActionButtons["Action Buttons<br/>üîò Edit/Save/Cancel/Restore/Remove"]
                    
                    Main --> CreateForm["RequirementCreateForm<br/>‚ûï New Requirement Creation"]
                    Main --> EditModal["RequirementEditForm<br/>üìù Modal Editing"]
                    
                    WorkItemReq --> WorkItemStorage["WorkItemStorage Class<br/>üíæ Independence Engine"]
                    WorkItemStorage --> StorageKeys["Storage Key Generation<br/>üîë selectedRequirements_{workItemId}"]
                    
                    WorkItemReq --> AutoRefreshSystem["Auto-refresh System<br/>üîÑ Real-time Updates"]
                    AutoRefreshSystem --> EventListeners["Event Listeners<br/>üì° Cross-frame Communication"]
                    
                    Main --> GlobalState["Global State Management<br/>üåê React Hooks"]
                    WorkItemReq --> LocalState["Local State Management<br/>üìç Work Item Specific"]
                    
                    GlobalState --> Requirements["requirements[]<br/>üìö Hub Requirements"]
                    LocalState --> WorkItemReqs["requirements[]<br/>üìã Work Item Requirements"]
                    LocalState --> EditingState["editing states<br/>‚úèÔ∏è Per-requirement editing"]
                    
                    style Main fill:#4caf50
                    style WorkItemReq fill:#2196f3
                    style WorkItemStorage fill:#ff9800
                    style AutoRefreshSystem fill:#9c27b0
                    style EditForm fill:#e91e63
                    style ActionButtons fill:#607d8b
            </div>
        </div>

        <h2>üîí Independence Architecture Deep Dive</h2>
        <div class="diagram-container">
            <div class="mermaid">
                graph LR
                    WI1["Work Item: 12345<br/>üìã Product Backlog Item"] --> Storage1["localStorage Key:<br/>selectedRequirements_12345"]
                    WI2["Work Item: 67890<br/>üêõ Bug"] --> Storage2["localStorage Key:<br/>selectedRequirements_67890"]
                    WI3["Work Item: 54321<br/>‚≠ê Epic"] --> Storage3["localStorage Key:<br/>selectedRequirements_54321"]
                    
                    Storage1 --> Data1["Requirement Set A<br/>üîí Completely Isolated"]
                    Storage2 --> Data2["Requirement Set B<br/>üîí Completely Isolated"]
                    Storage3 --> Data3["Requirement Set C<br/>üîí Completely Isolated"]
                    
                    Data1 --> Edit1["Edit State A<br/>‚úèÔ∏è Independent Modifications"]
                    Data2 --> Edit2["Edit State B<br/>‚úèÔ∏è Independent Modifications"]
                    Data3 --> Edit3["Edit State C<br/>‚úèÔ∏è Independent Modifications"]
                    
                    style WI1 fill:#e3f2fd
                    style WI2 fill:#fff3e0
                    style WI3 fill:#f1f8e9
                    style Storage1 fill:#e8f5e8
                    style Storage2 fill:#fff8e1
                    style Storage3 fill:#e0f2f1
                    style Data1 fill:#e1f5fe
                    style Data2 fill:#fef7e0
                    style Data3 fill:#e8f5e8
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#0078d4',
                primaryTextColor: '#323130',
                primaryBorderColor: '#605e5c',
                lineColor: '#605e5c',
                secondaryColor: '#e1e1e1',
                tertiaryColor: '#f3f2f1'
            }
        });
    </script>
</body>
</html>
